local Keys = {
    ["ESC"] = 322, ["F1"] = 288, ["F2"] = 289, ["F3"] = 170, ["F5"] = 166, ["F6"] = 167, ["F7"] = 168, ["F8"] = 169, ["F9"] = 56, ["F10"] = 57, 
    ["~"] = 243, ["1"] = 157, ["2"] = 158, ["3"] = 160, ["4"] = 164, ["5"] = 165, ["6"] = 159, ["7"] = 161, ["8"] = 162, ["9"] = 163, ["-"] = 84, ["="] = 83, ["BACKSPACE"] = 177, 
    ["TAB"] = 37, ["Q"] = 44, ["W"] = 32, ["E"] = 38, ["R"] = 45, ["T"] = 245, ["Y"] = 246, ["U"] = 303, ["P"] = 199, ["["] = 39, ["]"] = 40, ["ENTER"] = 18,
    ["CAPS"] = 137, ["A"] = 34, ["S"] = 8, ["D"] = 9, ["F"] = 23, ["G"] = 47, ["H"] = 74, ["K"] = 311, ["L"] = 182,
    ["LEFTSHIFT"] = 21, ["Z"] = 20, ["X"] = 73, ["C"] = 26, ["V"] = 0, ["B"] = 29, ["N"] = 249, ["M"] = 244, [","] = 82, ["."] = 81,
    ["LEFTCTRL"] = 36, ["LEFTALT"] = 19, ["SPACE"] = 22, ["RIGHTCTRL"] = 70, 
    ["HOME"] = 213, ["PAGEUP"] = 10, ["PAGEDOWN"] = 11, ["DELETE"] = 178,
    ["LEFT"] = 174, ["RIGHT"] = 175, ["TOP"] = 27, ["DOWN"] = 173,
    ["NENTER"] = 201, ["N4"] = 108, ["N5"] = 60, ["N6"] = 107, ["N+"] = 96, ["N-"] = 97, ["N7"] = 117, ["N8"] = 61, ["N9"] = 118
}
delivering = false
local zone = 0
local deliveryPed = 0
dArea = 0
visits = 0 
bagShroom = false
bagWeed = false

QBCore = nil
Citizen.CreateThread(function() 
    while QBCore == nil do
        TriggerEvent("QBCore:GetObject", function(obj) QBCore = obj end)    
        Citizen.Wait(200)
    end
end)

Citizen.CreateThread(function()
    mainblip = AddBlipForCoord(-229.99043273926, -910.71759033203, 32.310832977295)

    SetBlipSprite (mainblip, 318)
    SetBlipDisplay(mainblip, 4)
    SetBlipScale  (mainblip, 0.6)
    SetBlipColour (mainblip, 3)
    SetBlipAsShortRange(mainblip, true)

    BeginTextCommandSetBlipName("STRING")
    AddTextComponentString("DHL")
    EndTextCommandSetBlipName(mainblip)
end)

function hintToDisplay(text)
    SetTextComponentFormat("STRING")
    AddTextComponentString(text)
    DisplayHelpTextFromStringLabel(0, 0, 1, -1)
end
   
function DrawText3Ds(x,y,z, text)
    SetTextScale(0.35, 0.35)
    SetTextFont(4)
    SetTextProportional(1)
    SetTextColour(255, 255, 255, 215)
    SetTextEntry("STRING")
    SetTextCentre(true)
    AddTextComponentString(text)
    SetDrawOrigin(x,y,z, 0)
    DrawText(0.0, 0.0)
    local factor = (string.len(text)) / 370
    DrawRect(0.0, 0.0+0.0125, 0.017+ factor, 0.03, 0, 0, 0, 75)
    ClearDrawOrigin()
end


local postOP = {
    {x = -231.48,  y = -912.56,  z = 32.31} 
}
   --/tp -231.48 -912.56 32.31
Citizen.CreateThread(function()
    while true do
        Citizen.Wait(0)
        for k in pairs(postOP) do
            local plyCoords = GetEntityCoords(PlayerPedId(), false)
            local dist = Vdist(plyCoords.x, plyCoords.y, plyCoords.z, postOP[k].x, postOP[k].y, postOP[k].z)
   
            if dist <= 5 then
                --DrawText3Ds(postOP[k].x, postOP[k].y, postOP[k].z+1, ('Press [~g~E~w~] to start delivering'))
            end
        end
    end
end)



RegisterNetEvent('bagUpWeed')
AddEventHandler('bagUpWeed', function()
	bagWeed()
end)

RegisterNetEvent('stopworking')
AddEventHandler('stopworking', function()
	stopWorking()
end)



RegisterNetEvent('bagUpShrooms')
AddEventHandler('bagUpShrooms', function()
	bagShrooms()
end)



function bagWeed()
    exports["t0sic_loadingbar"]:StartDelayedFunction("Bagging up the weed ...", 30000, function()
        TriggerServerEvent('weedBagged')
            
    end)
end

function bagShrooms()
    exports["t0sic_loadingbar"]:StartDelayedFunction("Bagging up the shrooms ...", 30000, function()
        TriggerServerEvent('shroomsBagged')
            
    end)
end



-- Citizen.CreateThread(function()
--     local playerPed = PlayerPedId()
--     while true do
--         Citizen.Wait(0)
--         if bagWeed == true then 
--             exports["t0sic_loadingbar"]:StartDelayedFunction("Bagging up the weed ...", 30000, function()
--                 bagWeed = false
--                 TriggerServerEvent('weedBagged')
               
--             end)
--         else
--             bagWeed = false
--         end

--         if bagShroom == true then 
--             exports["t0sic_loadingbar"]:StartDelayedFunction("Bagging up the shrooms ...", 30000, function()
--                 bagShroom = false
--                 TriggerServerEvent('shroomsBagged')
                
--             end)
--         end           
--     end
-- end)



Citizen.CreateThread(function()
    local playerPed = PlayerPedId()
    while true do
        Citizen.Wait(0)
   
        for k in pairs(postOP) do
           
            local plyCoords = GetEntityCoords(PlayerPedId(), false)
            local dist = Vdist(plyCoords.x, plyCoords.y, plyCoords.z, postOP[k].x, postOP[k].y, postOP[k].z)
   
            if dist <= 5 then
                if IsControlJustPressed(0, Keys['E']) then
                    Citizen.Wait(100)
                    if delivering == true then
                        QBCore.Functions.Notify('You have returned the package.', 'error', 3500)
                        stopDeliver()
                        RemoveBlip(deliveryblip)
                    else
                        QBCore.Functions.Notify('Congratulations, you have a package to deliver!', 'error', 3500)
                        startDeliver()
                    end
                end			
            end
        end
    end
end)
   

function drawTxt(text, font, centre, x, y, scale, r, g, b, a)
    SetTextFont(font)
    SetTextProportional(0)
    SetTextScale(scale, scale)
    SetTextColour(r, g, b, a)
    SetTextDropShadow(0, 0, 0, 0, 255)
    SetTextEdge(1, 0, 0, 0, 255)
    SetTextDropShadow()
    SetTextOutline()
    SetTextCentre(centre)
    SetTextEntry("STRING")
    AddTextComponentString(text)
    DrawText(x, y)
end
 
local dPoints = { --285 locations
   
   { x = -11.7389554977417, y = -303.995056152344, z = 45.5747222900391250},
   { x = 146.843276977539, y = -300.878265380859, z = 45.3772392272949250},
   { x = 90.9032745361328, y = -287.846313476563, z = 46.2548522949219250},
   { x = -25.0742530822754, y = -232.339614868164, z = 45.9333648681641250},
   { x = -120.107566833496, y = -364.745635986328, z = 36.387809753418250},
   { x = -25.1990394592285, y = -195.758193969727, z = 52.1177139282227250},
   { x = -5.50260925292969, y = -146.08544921875, z = 56.2241859436035250},
   { x = 27.7411308288574, y = -210.56852722168, z = 52.6132545471191250},
   { x = 157.997344970703, y = -260.784973144531, z = 51.1468048095703250},
   { x = 114.574058532715, y = -245.457168579102, z = 51.1555404663086250},
   { x = 315.732696533203, y = -205.817001342773, z = 53.8409042358398250},
   { x = 335.27978515625, y = -213.279769897461, z = 53.8431167602539250},
   { x = 546.979309082031, y = -207.427703857422, z = 53.7732124328613250},
   { x = 303.611633300781, y = -174.296340942383, z = 57.4277954101563250},
   { x = 388.248901367188, y = -82.1120986938477, z = 67.4467544555664250},
   { x = 353.871612548828, y = -126.939880371094, z = 65.9824523925781250},
   { x = 267.145294189453, y = -150.983749389648, z = 63.5137596130371250},
   { x = 245.70703125, y = -145.144439697266, z = 63.2356109619141250},
   { x = 212.403762817383, y = -24.7241287231445, z = 69.4420166015625250},
   { x = 176.177703857422, y = -67.8491516113281, z = 68.2495803833008250},
   { x = 165.744750976563, y = -113.256736755371, z = 62.0614356994629250},
   { x = 196.085632324219, y = -157.104339599609, z = 56.4725303649902250},
   { x = 171.977188110352, y = -34.9312553405762, z = 67.7583847045898250},
   { x = 114.977584838867, y = -99.8651580810547, z = 60.4771919250488250},
   { x = 86.7692108154297, y = -100.260398864746, z = 59.1181831359863250},
   { x = 26.0904140472412, y = -73.1540985107422, z = 61.3461799621582250},
   { x = -11.983060836792, y = -78.6496200561523, z = 56.8573036193848250},
   { x = 11.9316091537476, y = -3.83730173110962, z = 69.9814147949219250},
   { x = 0.237976536154747, y = 27.7774333953857, z = 70.7471694946289250},
   { x = -45.3299217224121, y = -20.6062450408936, z = 68.2370071411133250},
   { x = -98.6652984619141, y = -63.4526863098145, z = 56.1215362548828250},
   { x = -108.958450317383, y = 36.9439506530762, z = 71.1790466308594250},
   { x = -185.084457397461, y = 97.5139465332031, z = 69.8506698608398250},
   { x = -166.521682739258, y = 114.104721069336, z = 70.0628509521484250},
   { x = -191.907958984375, y = 134.994033813477, z = 69.5727081298828250},
   { x = -264.137969970703, y = 198.03092956543, z = 85.0904312133789250},
   { x = -177.637008666992, y = 213.771255493164, z = 88.5552062988281250},
   { x = -182.930419921875, y = 316.721832275391, z = 97.5557632446289250},
   { x = -127.102439880371, y = 177.254760742188, z = 85.503044128418250},
   { x = -74.2093200683594, y = 145.735504150391, z = 81.1078872680664250},
   { x = 88.2836380004883, y = 184.7744140625, z = 104.354156494141250},
   { x = 78.4332656860352, y = 168.985961914063, z = 104.335487365723250},
   { x = 154.720397949219, y = 170.130432128906, z = 104.809013366699250},
   { x = 326.063537597656, y = 96.4807891845703, z = 99.490119934082250},
   { x = 382.353393554688, y = 63.7339401245117, z = 97.7345428466797250},
   { x = 338.004821777344, y = 41.2871208190918, z = 90.1132507324219250},
   { x = 274.633117675781, y = 4.60633182525635, z = 78.9510192871094250},
   { x = 281.837341308594, y = -45.6216087341309, z = 70.6862335205078250},
   { x = 381.503295898438, y = 115.495231628418, z = 102.33438873291250},
   { x = 649.293395996094, y = -10.4862375259399, z = 82.5059432983398250},
   { x = 683.592163085938, y = 72.1659393310547, z = 83.2104721069336250},
   { x = 549.217712402344, y = 154.938140869141, z = 98.9910430908203250},
   { x = 520.515747070313, y = 168.794052124023, z = 99.1263580322266250},
   { x = 437.372039794922, y = 222.17073059082, z = 102.921821594238250},
   { x = 368.649993896484, y = 339.2578125, z = 103.005744934082250},
   { x = 220.53923034668, y = 272.936248779297, z = 105.255218505859250},
   { x = 385.352111816406, y = -904.107788085938, z = 29.0522365570068400},
   { x = 365.969848632813, y = -824.960754394531, z = 28.8995971679688400},
   { x = 332.714202880859, y = -949.290710449219, z = 29.140661239624400},
   { x = 299.720153808594, y = -902.88330078125, z = 28.8994235992432400},
   { x = 323.334716796875, y = -683.579345703125, z = 28.9122982025146400},
   { x = 87.2545700073242, y = -819.47998046875, z = 30.7565860748291400},
   { x = 37.7948722839355, y = -1002.40435791016, z = 29.0543842315674400},
   { x = 101.742057800293, y = -1120.96765136719, z = 28.9251003265381400},
   { x = 307.379272460938, y = -1085.22058105469, z = 28.9452438354492400},
   { x = -47.2743873596191, y = -762.72216796875, z = 32.4531669616699400},
   { x = -274.226348876953, y = -564.568237304688, z = 29.7809448242188400},
   { x = -307.191253662109, y = -712.606811523438, z = 28.064624786377400},
   { x = -267.318206787109, y = -831.868835449219, z = 31.3706645965576400},
   { x = -292.107818603516, y = -988.930786132813, z = 23.7439479827881400},
   { x = -47.6948432922363, y = -785.235900878906, z = 43.8152542114258400},
   { x = 66.4006576538086, y = -734.228820800781, z = 43.8344421386719400},
   { x = 105.720031738281, y = -624.741760253906, z = 43.8211212158203400},
   { x = 495.365661621094, y = -778.442321777344, z = 24.4849834442139400},
   { x = 851.067077636719, y = -950.545227050781, z = 25.8883152008057400},
   { x = 849.662719726563, y = -1053.74816894531, z = 27.6498584747314400},
   { x = 902.838317871094, y = -142.258270263672, z = 76.3618240356445400},
   { x = 970.883605957031, y = -117.029663085938, z = 74.1100769042969400},
   { x = 945.690185546875, y = -255.781066894531, z = 67.2504653930664400},
   { x = 868.21728515625, y = -208.389022827148, z = 70.3895111083984400},
   { x = 768.811462402344, y = -156.665115356445, z = 74.2722396850586400},
   { x = 1203.64440917969, y = -454.903961181641, z = 66.4116821289063400},
   { x = 1151.87744140625, y = -461.1796875, z = 66.5673065185547400},
   { x = 1194.6396484375, y = -629.046875, z = 62.6697311401367400},
   { x = 1214.32604980469, y = -705.528747558594, z = 59.7364654541016400},
   { x = 1223.96301269531, y = -729.414794921875, z = 60.0188598632813400},
   { x = 1280.37512207031, y = -672.556762695313, z = 65.9052810668945400},
   { x = 1261.6884765625, y = -620.793701171875, z = 68.8272933959961400},
   { x = 1307.43054199219, y = -537.859313964844, z = 70.9507827758789400},
   { x = 1351.63500976563, y = -595.812377929688, z = 74.0946197509766400},
   { x = 1273.45751953125, y = -458.269714355469, z = 69.0017929077148400},
   { x = 1061.04089355469, y = -390.966857910156, z = 67.0905303955078400},
   { x = 993.396606445313, y = -436.334686279297, z = 63.6045150756836400},
   { x = 960.27783203125, y = -498.431579589844, z = 60.9737091064453400},
   { x = 946.991333007813, y = -510.247619628906, z = 59.9701652526855400},
   { x = 882.477783203125, y = -511.141693115234, z = 57.0853042602539400},
   { x = 878.437438964844, y = -556.980346679688, z = 57.0162239074707400},
   { x = 854.214904785156, y = -565.665466308594, z = 57.4186058044434400},
   { x = 917.097778320313, y = -621.714904785156, z = 57.5890579223633400},
   { x = 983.444641113281, y = -708.400329589844, z = 57.3073081970215400},
   { x = 1090.53833007813, y = -791.255737304688, z = 58.0193672180176400},
   { x = 1009.076171875, y = -590.626403808594, z = 58.690788269043400},
   { x = 1053.470703125, y = -489.113891601563, z = 63.5801620483398400},
   { x = 1071.23400878906, y = -447.562896728516, z = 65.3984756469727400},
   { x = 972.033752441406, y = -554.108215332031, z = 58.8319549560547400},
   { x = -206.080169677734, y = -1318.03527832031, z = 30.5125579833984500},
   { x = -151.778945922852, y = -1349.14709472656, z = 29.463903427124500},
   { x = -214.70263671875, y = -1359.99255371094, z = 30.8813018798828500},
   { x = -106.83226776123, y = -1457.93762207031, z = 33.0243949890137500},
   { x = -53.0842018127441, y = -1505.03540039063, z = 30.9284286499023500},
   { x = -191.262603759766, y = -1608.03076171875, z = 33.6884918212891750},
   { x = -107.097640991211, y = -1598.89270019531, z = 31.2714824676514500},
   { x = -13.6944303512573, y = -1453.07653808594, z = 29.963399887085500},
   { x = 11.373348236084, y = -1455.75622558594, z = 29.9189186096191500},
   { x = 148.119903564453, y = -1517.82336425781, z = 28.5764427185059500},
   { x = 224.491546630859, y = -1520.30322265625, z = 28.5792541503906500},
   { x = 403.846832275391, y = -1502.89172363281, z = 28.7238178253174500},
   { x = 467.354461669922, y = -1579.06457519531, z = 28.5578155517578500},
   { x = 393.531311035156, y = -1436.67004394531, z = 28.8963184356689500},
   { x = 333.338714599609, y = -1261.2724609375, z = 31.1195201873779500},
   { x = 497.880340576172, y = -1335.07336425781, z = 28.7632160186768500},
   { x = 498.269134521484, y = -1400.85144042969, z = 28.8060188293457500},
   { x = 479.41357421875, y = -1517.90832519531, z = 28.7261981964111500},
   { x = -63.1068229675293, y = -1789.77734375, z = 27.3188400268555600},
   { x = 18.1376876831055, y = -1879.91833496094, z = 22.6591415405273600},
   { x = 93.9403533935547, y = -1960.46398925781, z = 20.3599662780762600},
   { x = 115.805252075195, y = -1931.6064453125, z = 20.3829689025879600},
   { x = 157.643142700195, y = -1895.97875976563, z = 22.6697120666504600},
   { x = 199.111679077148, y = -1897.39379882813, z = 23.8366222381592600},
   { x = 176.815093994141, y = -1837.81481933594, z = 27.7052974700928600},
   { x = 243.076507568359, y = -1854.3154296875, z = 26.2651119232178600},
   { x = 227.982315063477, y = -1714.19995117188, z = 28.7936859130859600},
   { x = 335.734924316406, y = -1755.53869628906, z = 28.7484760284424600},
   { x = 298.528900146484, y = -1802.91943359375, z = 27.0873889923096600},
   { x = 128.719940185547, y = -1715.08996582031, z = 28.7247829437256600},
   { x = 431.897003173828, y = -1852.5224609375, z = 27.159065246582600},
   { x = 249.754867553711, y = -1955.12683105469, z = 22.7369632720947600},
   { x = 158.364028930664, y = -1969.00952148438, z = 18.1727161407471600},
   { x = 320.95068359375, y = -1983.98608398438, z = 22.5428123474121600},
   { x = 361.352874755859, y = -2062.46362304688, z = 21.1120758056641600},
   { x = 449.619964599609, y = -1961.78186035156, z = 22.5744915008545600},
   { x = 495.053131103516, y = -1969.17468261719, z = 24.5272254943848600},
   { x = 478.685485839844, y = -1888.86437988281, z = 25.7081508636475600},
   { x = 527.154907226563, y = -1830.65100097656, z = 27.7945537567139600},
   { x = 499.024108886719, y = -1720.14123535156, z = 28.9230213165283600},
   { x = 480.19287109375, y = -1776.34997558594, z = 28.17746925354600},
   { x = 516.267639160156, y = -1987.08154296875, z = 24.4292316436768600},
   { x = 83.5366134643555, y = -2560.27319335938, z = 5.61167287826538600},
   { x = -345.338989257813, y = 112.053901672363, z = 66.2454071044922500},
   { x = -397.341064453125, y = 136.209030151367, z = 65.0139541625977500},
   { x = -357.603210449219, y = 29.5045299530029, z = 47.3471260070801500},
   { x = -509.991149902344, y = 117.059188842773, z = 62.9262809753418500},
   { x = -426.307189941406, y = -24.4472904205322, z = 45.793270111084500},
   { x = -646.845886230469, y = 32.2951354980469, z = 38.9617385864258500},
   { x = -695.284729003906, y = 40.4299240112305, z = 42.7703437805176500},
   { x = -642.420593261719, y = 105.648887634277, z = 56.4914627075195500},
   { x = -477.898010253906, y = 224.572387695313, z = 82.6851654052734500},
   { x = -421.778564453125, y = 293.303253173828, z = 82.7933502197266500},
   { x = -349.973480224609, y = 217.803176879883, z = 86.0165405273438500},
   { x = -311.754608154297, y = 227.975570678711, z = 87.411506652832500},
   { x = -559.525512695313, y = 300.540161132813, z = 82.6860198974609500},
   { x = -773.259338378906, y = 297.901824951172, z = 85.1530609130859500},
   { x = -739.878601074219, y = 241.291397094727, z = 75.8833618164063500},
   { x = -639.6669921875, y = 168.995559692383, z = 60.6939163208008500},
   { x = -825.281616210938, y = 177.80989074707, z = 70.6563720703125500},
   { x = -839.051818847656, y = 113.525749206543, z = 54.7545013427734500},
   { x = -1046.44592285156, y = 219.620895385742, z = 63.1960334777832500},
   { x = -987.833129882813, y = 144.561172485352, z = 60.0635757446289500},
   { x = -956.985534667969, y = 115.316078186035, z = 56.3222732543945500},
   { x = -920.415832519531, y = 107.748840332031, z = 54.7536239624023500},
   { x = -953.544494628906, y = 187.443695068359, z = 66.0121154785156500},
   { x = -925.919921875, y = 12.5866889953613, z = 47.1334228515625500},
   { x = -833.679748535156, y = -35.751953125, z = 38.1416053771973500},
   { x = -891.493591308594, y = -2.13482284545898, z = 42.8728981018066500},
   { x = -707.653625488281, y = -185.055709838867, z = 36.286506652832500},
   { x = -736.120910644531, y = -135.057693481445, z = 36.6698455810547500},
   { x = -693.238952636719, y = -267.792358398438, z = 35.6989402770996500},
   { x = -725.841552734375, y = -424.554534912109, z = 34.6384391784668500},
   { x = -483.000213623047, y = -452.832427978516, z = 33.6180801391602500},
   { x = -930.965209960938, y = -461.445678710938, z = 36.5572166442871500},
   { x = -1022.22869873047, y = -492.600341796875, z = 36.393669128418500},
   { x = -1083.98754882813, y = -375.209869384766, z = 36.2828674316406500},
   { x = -1041.00256347656, y = -387.940582275391, z = 37.1276512145996500},
   { x = -489.890258789063, y = -57.8195838928223, z = 39.4080772399902500},
   { x = -459.117950439453, y = -137.876342773438, z = 37.7294998168945500},
   { x = -1158.54418945313, y = -226.049575805664, z = 37.3476867675781500},
   { x = -1096.38989257813, y = -317.182922363281, z = 37.0811614990234500},
   { x = -1167.88439941406, y = -335.995910644531, z = 37.0393447875977500},
   { x = -1159.66394042969, y = -399.218536376953, z = 35.2171363830566500},
   { x = -1285.06042480469, y = -428.360656738281, z = 34.1927833557129500},
   { x = -1345.60363769531, y = -293.904479980469, z = 39.556827545166500},
   { x = -1355.54406738281, y = -216.085372924805, z = 43.1127738952637500},
   { x = -1460.88781738281, y = -30.0602798461914, z = 54.0585327148438500},
   { x = -1549.58898925781, y = -82.2022399902344, z = 53.5496940612793500},
   { x = -1558.42346191406, y = -36.5513725280762, z = 56.2246398925781500},
   { x = -1465.9638671875, y = 40.2094383239746, z = 53.3123359680176500},
   { x = -1567.9599609375, y = 31.9729785919189, z = 58.474910736084500},
   { x = -1544.01892089844, y = 125.423881530762, z = 56.1950454711914500},
   { x = -1243.25708007813, y = 385.332092285156, z = 74.8804092407227500},
   { x = -1396.58581542969, y = -294.828826904297, z = 42.9301376342773500},
   { x = -1275.1884765625, y = -558.754516601563, z = 29.4832954406738500},
   { x = -1198.26147460938, y = -732.103393554688, z = 20.338794708252600},
   { x = -1221.9326171875, y = -705.452880859375, z = 21.9235076904297600},
   { x = -754.695373535156, y = -912.980224609375, z = 18.7608795166016600},
   { x = -822.445251464844, y = -990.14111328125, z = 13.0752420425415600},
   { x = -770.191345214844, y = -1302.67626953125, z = 4.40547657012939600},
   { x = -855.579284667969, y = -1270.13977050781, z = 4.41537761688232600},
   { x = -683.339782714844, y = -885.247619628906, z = 23.9142284393311600},
   { x = -948.41650390625, y = -1082.64819335938, z = 1.5385490655899600},
   { x = -1072.21813964844, y = -1158.8486328125, z = 1.52664005756378600},
   { x = -988.570922851563, y = -985.8173828125, z = 1.36811316013336600},
   { x = -1120.69995117188, y = -1063.10327148438, z = 1.39628577232361600},
   { x = -1093.37817382813, y = -919.305236816406, z = 2.29149770736694600},
   { x = -1276.34350585938, y = -1152.94787597656, z = 5.5441370010376600},
   { x = -1253.9658203125, y = -1197.61608886719, z = 6.34510087966919600},
   { x = -1339.50646972656, y = -1210.49499511719, z = 3.96823167800903600},
   { x = -1279.34484863281, y = -1251.06213378906, z = 3.29812169075012600},
   { x = -1153.234375, y = -1520.67614746094, z = 3.64794492721558600},
   { x = -1185.71105957031, y = -1562.92419433594, z = 3.65394926071167600},
   { x = -1132.697265625, y = -1582.4326171875, z = 3.55767679214478600},
   { x = -1083.09106445313, y = -1535.39392089844, z = 3.84467601776123600},
   { x = -1067.95288085938, y = -1538.41821289063, z = 4.11108350753784600},
   { x = -1021.89056396484, y = -1519.9560546875, z = 4.89227819442749600},
   { x = -1054.50463867188, y = -1571.13122558594, z = 4.0337233543396600},
   { x = -1105.31286621094, y = -1681.4150390625, z = 3.62900733947754600},
   { x = -941.772766113281, y = -1524.78881835938, z = 4.33578824996948600},
   { x = -990.477905273438, y = -1437.67309570313, z = 4.34794092178345600},
   { x = -1210.47351074219, y = -1148.54956054688, z = 6.94658946990967600},
   { x = -1379.82702636719, y = -973.952514648438, z = 8.07372856140137600},
   { x = -1468.36853027344, y = -925.037353515625, z = 9.58611583709717600},
   { x = -1297.83459472656, y = -787.924682617188, z = 17.0836410522461600},
   { x = -1268.61389160156, y = -818.876708984375, z = 16.6243114471436600},
   { x = -1407.99182128906, y = -735.800415039063, z = 23.0887184143066600},
   { x = -1377.88793945313, y = -652.622497558594, z = 28.2150058746338600},
   { x = -1642.96533203125, y = -993.046203613281, z = 12.5428237915039600},
   { x = -1691.28979492188, y = -1068.29382324219, z = 12.5562171936035600},
   { x = -1818.53234863281, y = -1210.51550292969, z = 12.5427179336548600},
   { x = -1540.11462402344, y = -582.15087890625, z = 33.2285423278809600},
   { x = -1526.26147460938, y = -281.718872070313, z = 48.6887893676758600},
   { x = -1570.37072753906, y = -288.545227050781, z = 47.6945915222168600},
   { x = -1567.60192871094, y = -236.082565307617, z = 48.8926277160645600},
   { x = -1610.322265625, y = -382.220367431641, z = 42.5706596374512600},
   { x = -1608.48828125, y = -413.600250244141, z = 40.8177070617676600},
   { x = -1668.81750488281, y = -452.784637451172, z = 38.6393394470215600},
   { x = -1714.82043457031, y = -502.125366210938, z = 37.5113868713379600},
   { x = -1711.01318359375, y = -416.278228759766, z = 44.0267486572266600},
   { x = -1656.42749023438, y = -357.58056640625, z = 48.8499755859375600},
   { x = -1775.29406738281, y = -364.032867431641, z = 44.7817306518555600},
   { x = -1863.40234375, y = -352.799896240234, z = 48.6571655273438600},
   { x = -2183.59985351563, y = -408.342437744141, z = 12.469780921936600},
   { x = -1929.66540527344, y = -530.206298828125, z = 11.2496871948242600},
   { x = -1897.53198242188, y = -556.751281738281, z = 11.154369354248600},
   { x = -1862.7236328125, y = -585.575744628906, z = 10.9879150390625600},
   { x = -1802.40234375, y = -637.487426757813, z = 10.4068717956543600},
   { x = -1758.70397949219, y = -682.206176757813, z = 9.49457454681396600},
   { x = -1082.61889648438, y = 456.733764648438, z = 76.3031158447266600},
   { x = -1039.49841308594, y = 496.919799804688, z = 82.054817199707600},
   { x = -858.334350585938, y = 515.422668457031, z = 89.1987915039063600},
   { x = -918.225280761719, y = 579.730895996094, z = 99.0909881591797600},
   { x = -1022.71704101563, y = 593.901428222656, z = 102.37043762207600},
   { x = -1383.03857421875, y = 450.747894287109, z = 104.104797363281600},
   { x = -1449.8525390625, y = 531.747314453125, z = 118.468521118164600},
   { x = -1539.69030761719, y = 427.578247070313, z = 108.835731506348600},
   { x = -1353.65515136719, y = 567.254638671875, z = 129.946884155273600},
   { x = -1284.90588378906, y = 644.803039550781, z = 138.594711303711600},
   { x = -1117.29162597656, y = 774.75341796875, z = 161.646728515625600},
   { x = -1048.46252441406, y = 767.957885742188, z = 166.836151123047600},
   { x = -910.521057128906, y = 697.753173828125, z = 150.719833374023600},
   { x = -695.307739257813, y = 666.498901367188, z = 153.162490844727600},
   { x = -696.717468261719, y = 706.821899414063, z = 156.824630737305600},
   { x = -580.781188964844, y = 739.828308105469, z = 183.007995605469600},
   { x = -746.078308105469, y = 816.215942382813, z = 212.794815063477600},
   { x = -968.549499511719, y = 764.239562988281, z = 174.750885009766600},
   { x = -472.506805419922, y = 652.219665527344, z = 143.608108520508600},
   { x = -347.918975830078, y = 636.378967285156, z = 171.423629760742600},
   { x = -225.667541503906, y = 594.723815917969, z = 189.643768310547600},
   { x = -483.942352294922, y = 553.29541015625, z = 119.060554504395600},
   { x = -411.493103027344, y = 555.736389160156, z = 123.182189941406600},
   { x = -362.981781005859, y = 509.676635742188, z = 118.377410888672600},
   { x = -231.069961547852, y = 497.976867675781, z = 127.233642578125600},
   { x = -3.63188219070435, y = 472.345947265625, z = 145.123123168945600},
   { x = 115.164993286133, y = 490.907501220703, z = 146.428985595703600},
   { x = 226.296096801758, y = 679.674255371094, z = 188.863845825195600},
   { x = 118.493515014648, y = 569.005310058594, z = 182.409606933594600},
   { x = 9.64954662322998, y = 545.573791503906, z = 175.11296081543600},
   }
   

   


function startDeliver()
    --TriggerEvent("mt:missiontext", "Drive to the marked ~g~destination~w~.", 10000)
    QBCore.Functions.Notify("You have packages to deliver, follow the waypoint", "success", 10000)
   
    delivering = true
   
    zone = math.random(1,5)
    if zone == 1 then
       dArea = math.random(1,75)
    end
    if zone == 2 then 
       dArea = math.random(76,150)
    end
    if zone == 3 then
       dArea  = math.random(151,200)
    end
    if zone == 4 then
       dArea = math.random(201, 250)
    end
    if zone == 5 then 
       dArea = math.random(1,285)
    end
 
   
    deliveryblip = (AddBlipForCoord(dPoints[dArea].x, dPoints[dArea].y, dPoints[dArea].z))
    SetBlipSprite(deliveryblip, 280)
    SetNewWaypoint(dPoints[dArea].x, dPoints[dArea].y)
end

local pedCreated = false 
Citizen.CreateThread(function()
    while true do   
        Citizen.Wait(0)
        if delivering == true then
            local plyCoords = GetEntityCoords(PlayerPedId(), false)
            local dist = Vdist(plyCoords.x, plyCoords.y, plyCoords.z, dPoints[dArea].x, dPoints[dArea].y, dPoints[dArea].z)
            if dist < 150.0 and not pedCreated then
                pedCreated = true
                CreateDeliveryPed()
                QBCore.Functions.Notify('You are close to the drop off', 'error', 3500)
            end  
            if dist <= 1.5 and not IsPedInAnyVehicle(PlayerPedId()) then
                DrawText3Ds(dPoints[dArea].x, dPoints[dArea].y, dPoints[dArea].z+1, ('Press [~g~E~w~] to  deliver the package'))
                if IsControlJustPressed(0, Keys['E']) then
                    giveAnim()
                    PlayAmbientSpeech1(deliveryPed, "Chat_State", "Speech_Params_Force")
                    QBCore.Functions.Progressbar("drop_off_package", "Dropping off Package..", 5000, false, true, {}, {}, {}, {}, function() 
                        delivered()
                        pedCreated = false
                    end)
                end
            end
        end
    end
end)


function CreateDeliveryPed()
    local hashKey = `a_m_y_stwhi_01`
    local pedType = 5
    RequestModel(hashKey)
    while not HasModelLoaded(hashKey) do
        RequestModel(hashKey)
        Citizen.Wait(10)
    end

	deliveryPed = CreatePed(pedType, hashKey, dPoints[dArea].x, dPoints[dArea].y, dPoints[dArea].z)
    ClearPedTasks(deliveryPed)
    ClearPedSecondaryTask(deliveryPed)
    TaskSetBlockingOfNonTemporaryEvents(deliveryPed, true)
    SetPedFleeAttributes(deliveryPed, 0, 0)
    SetPedCombatAttributes(deliveryPed, 17, 1)

    SetPedSeeingRange(deliveryPed, 0.0)
    SetPedHearingRange(deliveryPed, 0.0)
    SetPedAlertness(deliveryPed, 0)
    SetPedKeepTask(deliveryPed, true)
end

function DeleteCreatedPed()
	if DoesEntityExist(deliveryPed) then 
		SetPedKeepTask(deliveryPed, false)
		TaskSetBlockingOfNonTemporaryEvents(deliveryPed, false)
		ClearPedTasks(deliveryPed)
		TaskWanderStandard(deliveryPed, 10.0, 10)
		SetPedAsNoLongerNeeded(deliveryPed)

		Citizen.Wait(20)
		DeletePed(deliveryPed)
	end
end

function loadAnimDict( dict )
    while ( not HasAnimDictLoaded( dict ) ) do
        RequestAnimDict( dict )
        Citizen.Wait( 5 )
    end
end 

function playerAnim() 
	loadAnimDict( "mp_safehouselost@" )
    TaskPlayAnim( PlayerPedId(), "mp_safehouselost@", "package_dropoff", 8.0, 1.0, -1, 16, 0, 0, 0, 0 )
end

function giveAnim()
    if ( DoesEntityExist( deliveryPed ) and not IsEntityDead( deliveryPed ) ) then 
        loadAnimDict( "mp_safehouselost@" )
        if ( IsEntityPlayingAnim( deliveryPed, "mp_safehouselost@", "package_dropoff", 3 ) ) then 
            TaskPlayAnim( deliveryPed, "mp_safehouselost@", "package_dropoff", 8.0, 1.0, -1, 16, 0, 0, 0, 0 )
        else
            TaskPlayAnim( deliveryPed, "mp_safehouselost@", "package_dropoff", 8.0, 1.0, -1, 16, 0, 0, 0, 0 )
        end     
    end
end

-- Citizen.CreateThread(function()
--     while true do 
--         Citizen.Wait(0)
--         if delivering == true then
            
--             local plyCoords = GetEntityCoords(PlayerPedId(), false)
--             local dist = Vdist(plyCoords.x, plyCoords.y, plyCoords.z, dPoints[dArea].x, dPoints[dArea].y, dPoints[dArea].z)
   
--             if dist <= 5 and not IsPedInAnyVehicle(ped) then
--                 drawTxt('Press ~g~E~s~ to deliver your ~b~ package', 2, 1, 0.5, 0.8, 0.6, 255, 255, 255, 255)
--                 if IsControlJustPressed(0, Keys['E']) then
--                     delivered()
--                 end
--             end
--         end
--     end
-- end)
   
function stopDeliver()
    delivering = false    
end


function delivered()
    TriggerServerEvent('postOP:success')
        if visits == 5 then --change 3 to however many runs you want a person to be able to make before having to return to the depot
            RemoveBlip(deliveryblip)
            visits = 1
            QBCore.Functions.Notify("No more packages to deliver", "error", 10000)
            DeleteCreatedPed()
        else
            RemoveBlip(deliveryblip)
            startDeliver()
            visits = visits + 1
        end
end

RegisterNetEvent('qb-postop:client:dhl')
AddEventHandler('qb-postop:client:dhl', function()
    startDeliver()
end)

   